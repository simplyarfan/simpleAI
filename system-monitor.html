<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ SimpleAI System Status Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 48px rgba(0,0,0,0.15);
        }
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .status-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 12px;
            animation: pulse 2s infinite;
        }
        .status-success { background: #10b981; }
        .status-error { background: #ef4444; }
        .status-warning { background: #f59e0b; }
        .status-loading { background: #8b5cf6; }
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }
        .card-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #1f2937;
        }
        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        .metric:last-child { border-bottom: none; }
        .metric-label {
            color: #6b7280;
            font-weight: 500;
        }
        .metric-value {
            font-weight: 600;
            color: #1f2937;
        }
        .log-container {
            background: #1f2937;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        .log-entry {
            display: flex;
            margin-bottom: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        .log-timestamp {
            color: #9ca3af;
            margin-right: 12px;
            min-width: 80px;
        }
        .log-message {
            color: #f9fafb;
        }
        .log-success { color: #10b981; }
        .log-error { color: #ef4444; }
        .log-warning { color: #f59e0b; }
        .controls {
            text-align: center;
            margin-bottom: 20px;
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #f3f4f6;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #3b82f6);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        .timeline {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
        }
        .timeline-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-left: 3px solid #e5e7eb;
            padding-left: 20px;
            margin-left: 10px;
            position: relative;
        }
        .timeline-item.completed {
            border-left-color: #10b981;
        }
        .timeline-item.active {
            border-left-color: #3b82f6;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e5e7eb;
        }
        .timeline-item.completed::before {
            background: #10b981;
        }
        .timeline-item.active::before {
            background: #3b82f6;
            animation: pulse 1s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ SimpleAI System Monitor</h1>
            <p>Real-time monitoring of all system components and services</p>
        </div>

        <div class="controls">
            <button class="btn" onclick="runFullSystemCheck()" id="checkBtn">üîç Run System Check</button>
            <a href="https://thesimpleai.netlify.app/superadmin" target="_blank" class="btn">üñ•Ô∏è Open Dashboard</a>
            <a href="https://thesimpleai.netlify.app/auth/login" target="_blank" class="btn">üîê Login Page</a>
            <button class="btn" onclick="autoRefresh = !autoRefresh; updateAutoButton()" id="autoBtn">‚è∏Ô∏è Pause Auto-Check</button>
        </div>

        <div class="grid">
            <!-- Backend Status -->
            <div class="card">
                <div class="card-header">
                    <div class="status-icon status-loading" id="backend-status"></div>
                    <div class="card-title">Backend Services</div>
                </div>
                <div class="metric">
                    <span class="metric-label">API Server</span>
                    <span class="metric-value" id="api-status">Checking...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Database</span>
                    <span class="metric-value" id="db-status">Checking...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Authentication</span>
                    <span class="metric-value" id="auth-status">Checking...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Response Time</span>
                    <span class="metric-value" id="response-time">---</span>
                </div>
            </div>

            <!-- Frontend Status -->
            <div class="card">
                <div class="card-header">
                    <div class="status-icon status-loading" id="frontend-status"></div>
                    <div class="card-title">Frontend Application</div>
                </div>
                <div class="metric">
                    <span class="metric-label">Deployment</span>
                    <span class="metric-value" id="deployment-status">Checking...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">API Connection</span>
                    <span class="metric-value" id="api-connection">Checking...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Load Time</span>
                    <span class="metric-value" id="load-time">---</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Environment</span>
                    <span class="metric-value" id="env-status">Production</span>
                </div>
            </div>

            <!-- Database Status -->
            <div class="card">
                <div class="card-header">
                    <div class="status-icon status-loading" id="database-status"></div>
                    <div class="card-title">Database & Data</div>
                </div>
                <div class="metric">
                    <span class="metric-label">Total Users</span>
                    <span class="metric-value" id="total-users">---</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Superadmins</span>
                    <span class="metric-value" id="superadmin-count">---</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Tables</span>
                    <span class="metric-value" id="table-count">---</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Connection</span>
                    <span class="metric-value" id="db-connection">Checking...</span>
                </div>
            </div>

            <!-- System Health -->
            <div class="card">
                <div class="card-header">
                    <div class="status-icon status-loading" id="system-status"></div>
                    <div class="card-title">System Health</div>
                </div>
                <div class="metric">
                    <span class="metric-label">Overall Status</span>
                    <span class="metric-value" id="overall-status">Checking...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Last Check</span>
                    <span class="metric-value" id="last-check">---</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Uptime</span>
                    <span class="metric-value" id="uptime">---</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Issues</span>
                    <span class="metric-value" id="issues-count">0</span>
                </div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="card">
            <h3>System Check Progress</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progress" style="width: 0%"></div>
            </div>
            <p id="progress-text">Ready to check system status...</p>
        </div>

        <!-- Timeline -->
        <div class="timeline">
            <h3 style="margin-bottom: 20px;">üïí Deployment Timeline</h3>
            <div class="timeline-item" id="step-1">
                <div>
                    <strong>Backend Deployment</strong><br>
                    <small>Vercel deployment with new endpoints</small>
                </div>
            </div>
            <div class="timeline-item" id="step-2">
                <div>
                    <strong>Password Reset</strong><br>
                    <small>Set admin password to correct value</small>
                </div>
            </div>
            <div class="timeline-item" id="step-3">
                <div>
                    <strong>Frontend Deployment</strong><br>
                    <small>Netlify deployment with hardcoded API URL</small>
                </div>
            </div>
            <div class="timeline-item" id="step-4">
                <div>
                    <strong>Authentication Test</strong><br>
                    <small>Verify login with admin123</small>
                </div>
            </div>
            <div class="timeline-item" id="step-5">
                <div>
                    <strong>Dashboard Verification</strong><br>
                    <small>Confirm all systems operational</small>
                </div>
            </div>
        </div>

        <!-- Live Logs -->
        <div class="log-container">
            <h3 style="color: #f9fafb; margin-bottom: 15px;">üìã Live System Logs</h3>
            <div id="logs"></div>
        </div>
    </div>

    <script>
        let autoRefresh = true;
        let checkInProgress = false;
        let startTime = Date.now();
        let issuesCount = 0;

        function addLog(message, type = 'info') {
            const logs = document.getElementById('logs');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'success' ? 'log-success' : 
                              type === 'error' ? 'log-error' : 
                              type === 'warning' ? 'log-warning' : '';
            
            entry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-message ${colorClass}">${message}</span>
            `;
            
            logs.insertBefore(entry, logs.firstChild);
            
            // Keep only last 20 logs
            while (logs.children.length > 20) {
                logs.removeChild(logs.lastChild);
            }
        }

        function updateProgress(percent, text) {
            document.getElementById('progress').style.width = percent + '%';
            document.getElementById('progress-text').textContent = text;
        }

        function updateTimelineStep(stepNumber, status) {
            const step = document.getElementById(`step-${stepNumber}`);
            step.className = `timeline-item ${status}`;
        }

        function updateStatus(elementId, status, value = null) {
            const element = document.getElementById(elementId);
            if (element) {
                if (value !== null) {
                    element.textContent = value;
                }
                
                // Update status icon
                const statusIcon = document.getElementById(elementId.replace('-status', '') + '-status');
                if (statusIcon) {
                    statusIcon.className = `status-icon status-${status}`;
                }
            }
        }

        async function testBackend() {
            addLog('üîç Testing backend services...', 'info');
            updateProgress(10, 'Testing backend API...');
            
            const startTime = Date.now();
            
            try {
                // Test simple analytics endpoint
                const response = await fetch('https://thesimpleai.vercel.app/api/test-analytics');
                const responseTime = Date.now() - startTime;
                
                document.getElementById('response-time').textContent = responseTime + 'ms';
                
                if (response.ok) {
                    const data = await response.json();
                    updateStatus('backend', 'success');
                    updateStatus('api', 'success', '‚úÖ Online');
                    updateStatus('db', 'success', '‚úÖ Connected');
                    updateStatus('db-connection', 'success', '‚úÖ Active');
                    
                    document.getElementById('total-users').textContent = data.data?.totalUsers || 0;
                    document.getElementById('table-count').textContent = 'Available';
                    
                    addLog('‚úÖ Backend services operational', 'success');
                    updateTimelineStep(1, 'completed');
                    return true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                updateStatus('backend', 'error');
                updateStatus('api', 'error', '‚ùå Offline');
                updateStatus('db', 'error', '‚ùå Error');
                addLog(`‚ùå Backend error: ${error.message}`, 'error');
                issuesCount++;
                return false;
            }
        }

        async function resetPassword() {
            addLog('üîë Resetting admin password...', 'info');
            updateProgress(25, 'Resetting admin password...');
            
            try {
                const response = await fetch('https://thesimpleai.vercel.app/api/reset-admin-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addLog('‚úÖ Password reset to: admin123', 'success');
                    updateTimelineStep(2, 'completed');
                    return true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                addLog(`‚ùå Password reset failed: ${error.message}`, 'error');
                issuesCount++;
                return false;
            }
        }

        async function testUserManagement() {
            addLog('üë• Testing user management...', 'info');
            updateProgress(70, 'Testing user management system...');
            
            try {
                const response = await fetch('https://thesimpleai.vercel.app/api/users-simple');
                
                if (response.ok) {
                    const data = await response.json();
                    const userCount = data.data?.users?.length || 0;
                    const totalUsers = data.data?.pagination?.total || 0;
                    
                    addLog(`‚úÖ User management working - Found ${userCount} users`, 'success');
                    
                    // Update metrics
                    document.getElementById('total-users').textContent = totalUsers;
                    
                    return true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                addLog(`‚ùå User management failed: ${error.message}`, 'error');
                issuesCount++;
                return false;
            }
        }
        
        async function testProfile(token) {
            addLog('üë§ Testing profile system...', 'info');
            
            try {
                const response = await fetch('https://thesimpleai.vercel.app/api/profile-simple', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addLog(`‚úÖ Profile system working - User: ${data.data?.user?.email}`, 'success');
                    return true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                addLog(`‚ùå Profile system failed: ${error.message}`, 'error');
                issuesCount++;
                return false;
            }
        }
        async function testAuth() {
            addLog('üîê Testing authentication...', 'info');
            updateProgress(40, 'Testing login system...');
            
            try {
                const response = await fetch('https://thesimpleai.vercel.app/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'syedarfan@securemaxtech.com',
                        password: 'admin123'
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    updateStatus('auth', 'success', '‚úÖ Working');
                    document.getElementById('superadmin-count').textContent = '1';
                    addLog(`‚úÖ Login successful - Role: ${data.user?.role}`, 'success');
                    updateTimelineStep(4, 'completed');
                    return data.accessToken;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                updateStatus('auth', 'error', '‚ùå Failed');
                addLog(`‚ùå Authentication failed: ${error.message}`, 'error');
                issuesCount++;
                return null;
            }
        }

        async function testFrontend() {
            addLog('üåê Testing frontend deployment...', 'info');
            updateProgress(60, 'Testing frontend application...');
            
            const startTime = Date.now();
            
            try {
                const response = await fetch('https://thesimpleai.netlify.app/superadmin');
                const loadTime = Date.now() - startTime;
                
                document.getElementById('load-time').textContent = loadTime + 'ms';
                
                if (response.ok) {
                    updateStatus('frontend', 'success');
                    updateStatus('deployment', 'success', '‚úÖ Live');
                    updateStatus('api-connection', 'success', '‚úÖ Connected');
                    addLog('‚úÖ Frontend deployment successful', 'success');
                    updateTimelineStep(3, 'completed');
                    return true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                updateStatus('frontend', 'error');
                updateStatus('deployment', 'error', '‚ùå Failed');
                updateStatus('api-connection', 'error', '‚ùå Error');
                addLog(`‚ùå Frontend error: ${error.message}`, 'error');
                issuesCount++;
                return false;
            }
        }

        async function runFullSystemCheck() {
            if (checkInProgress) return;
            
            checkInProgress = true;
            issuesCount = 0;
            
            const checkBtn = document.getElementById('checkBtn');
            checkBtn.disabled = true;
            checkBtn.textContent = 'üîÑ Checking...';
            
            addLog('üöÄ Starting comprehensive system check...', 'info');
            updateProgress(0, 'Initializing system check...');
            
            // Reset all timeline steps
            for (let i = 1; i <= 5; i++) {
                updateTimelineStep(i, '');
            }
            updateTimelineStep(1, 'active');
            
            // Run tests in sequence
            const backendOk = await testBackend();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            updateTimelineStep(2, 'active');
            const passwordReset = await resetPassword();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            updateTimelineStep(3, 'active');
            const frontendOk = await testFrontend();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            updateTimelineStep(4, 'active');
            const token = await testAuth();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // Test user management
            const userMgmtOk = await testUserManagement();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // Test profile system if we have a token
            let profileOk = true;
            if (token) {
                profileOk = await testProfile(token);
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            updateTimelineStep(5, 'active');
            updateProgress(80, 'Finalizing system check...');
            
            // Final status
            const allSystemsOk = backendOk && frontendOk && token && passwordReset && userMgmtOk && profileOk;
            
            if (allSystemsOk) {
                updateStatus('system', 'success');
                updateStatus('overall', 'success', '‚úÖ All Systems Operational');
                addLog('üéâ ALL SYSTEMS OPERATIONAL!', 'success');
                updateProgress(100, '‚úÖ All systems operational!');
                updateTimelineStep(5, 'completed');
            } else {
                updateStatus('system', 'error');
                updateStatus('overall', 'error', `‚ùå ${issuesCount} Issues Found`);
                addLog(`‚ö†Ô∏è System check completed with ${issuesCount} issues`, 'warning');
                updateProgress(100, `‚ö†Ô∏è ${issuesCount} issues found`);
            }
            
            document.getElementById('issues-count').textContent = issuesCount;
            document.getElementById('last-check').textContent = new Date().toLocaleTimeString();
            
            checkInProgress = false;
            checkBtn.disabled = false;
            checkBtn.textContent = 'üîç Run System Check';
            
            if (allSystemsOk) {
                addLog('üéØ Ready for production use! Visit: https://thesimpleai.netlify.app/superadmin', 'success');
            }
        }

        function updateAutoButton() {
            const btn = document.getElementById('autoBtn');
            btn.textContent = autoRefresh ? '‚è∏Ô∏è Pause Auto-Check' : '‚ñ∂Ô∏è Resume Auto-Check';
        }

        function updateUptime() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('uptime').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        // Auto-refresh every 30 seconds
        setInterval(() => {
            if (autoRefresh && !checkInProgress) {
                runFullSystemCheck();
            }
        }, 30000);

        // Update uptime every second
        setInterval(updateUptime, 1000);

        // Initial system check
        addLog('üåü System monitor initialized', 'info');
        setTimeout(runFullSystemCheck, 2000);
    </script>
</body>
</html>
